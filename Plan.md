# 実装計画

この計画は `Document.md`（仕様書、2026-01-16）に基づき、確定要件をマイルストーンと成果物へ落とし込んだものです。

## スコープ
- 対象: 日本語縦書き脚本制作と A4 PDF 出力に対応する Windows デスクトップアプリ。
- 必須: WYSIWYG 縦書きレイアウト、レコード単位編集、PDF 出力、テキスト出力形式、役名色ラベル。
- スコープ外（将来）: 検索/置換、履歴/差分表示、役名辞書の高度な UX。

## マイルストーン

### M1. プロジェクト雛形と UI シェル
- UI 技術を選定し、単一ドキュメント表示の最小エディタ画面を作成する。
- アプリ基本設定を定義する（A4、余白、游明朝 10.5pt、行間 1.0）。
- ファイルの開く/保存のメニュー枠を追加する。

成果物: アプリが起動し、ページ枠を持つ空の縦書き編集領域が表示される。

### M2. データモデルとドキュメントライフサイクル
- レコードモデル `{ roleName: string, body: string }` の配列を実装する。
- ドキュメント状態: records, pageNumberEnabled, roleDictionary（役名 -> 色）。
- 独自ファイル形式で保存/読込（バージョン付き）。最小構成で安定させる。

成果物: レコードと設定を含む作成/保存/読込が可能。

### M3. 縦書きレイアウトエンジン（WYSIWYG）
- A4 固定余白で、右から左へ縦書き列にレコードを配置する。
- レコード間の間隔を 1.0 文字分に固定する。
- Keep-together: レコードは改ページで分割しない。
- 溢れ検知: 1レコードが1ページを超える場合は警告状態を付与する。

成果物: 編集表示が PDF レイアウトと一致し、溢れ警告が表示される。

### M4. 編集挙動とキー操作
- レコード内の役名/本文セルを Tab/Shift+Tab/Enter で移動する。
- Ctrl+Enter で次レコードへ移動/作成する。
- 本文 Enter ルール: 通常は改行、空行なら次レコードへ移動、Shift+Enter で強制改行。
- 空レコードで Backspace を押すと削除する。

成果物: キーボード挙動が `Document.md` の仕様と一致する。

### M5. 役名ラベル表示と色付与
- 役名ラベルはレコード先頭列にのみ表示する。
- 役名が空でも先頭列の領域は確保する。
- 役名色は役名ごとに編集可能で、同名役は統合される。

成果物: 役名ラベルに背景色が付与され、簡易的な色設定 UI がある。

### M6. テキスト出力
- 連続選択したレコードをテキスト出力する。
  - 役名あり: `役名「本文」`
  - 役名なし: 本文のみ
- 本文内改行は 1 行に畳む。

成果物: 仕様通りのコピー/書き出しが可能。

### M7. PDF 出力と印刷
- PDF 出力が画面表示と一致する。
- ページ番号は下中央、ON/OFF 切替可能。
- 溢れ警告が残っている場合は出力を停止し、メッセージを表示する。

成果物: WYSIWYG と一致する A4 PDF を出力できる。

### M8. 品質と配布
- レイアウト規則、シリアライズ、キー操作の基本テスト。
- Windows 向けインストーラまたはポータブル配布。

成果物: リリース可能なビルド。

## 早期に確定すべきリスクと判断
- 縦書きレイアウト精度と PDF レンダラの一致性。
- カスタム編集コンポーネントでの IME 対応。
- ファイル形式のバージョニング方針。

## テスト計画（最小）
- レイアウト: レコード間隔、役名ラベル位置、改ページ keep-together。
- 入力: キー移動規則とレコード削除挙動。
- 出力: テキスト/PDF が要件と一致すること。

## 成果物まとめ
- レコード単位の WYSIWYG 縦書きエディタ。
- バージョン付き独自ファイル形式。
- PDF 出力とテキスト出力。
- 役名辞書と色ラベル。
