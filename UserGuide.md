# VerticalScenarioEditer (VSE) User Guide

このドキュメントは、VSE を使って「縦書き脚本」を作成し、PDFやテキストとして出力するための利用者向けガイドです。  
厳密な仕様（固定値、警告条件、入出力ルールの詳細など）は [Document.md](./Document.md) を正とします。

---

## 目次

- [1. まずは1ページ作る（クイックスタート）](#1-まずは1ページ作るクイックスタート)
- [2. 用語と基本概念](#2-用語と基本概念)
- [3. 編集の基本（入力・改行・レコード追加）](#3-編集の基本入力改行レコード追加)
- [4. モードの使い分け](#4-モードの使い分け)
- [5. PDF出力の手順と注意](#5-pdf出力の手順と注意)
- [6. テキスト出力（整形出力／範囲出力）](#6-テキスト出力整形出力範囲出力)
- [7. テキスト読み込み（UTF-8）](#7-テキスト読み込みutf-8)
- [8. 見た目・表示の調整（倍率・罫線・記号など）](#8-見た目表示の調整倍率罫線記号など)
- [9. よくある質問（FAQ）](#9-よくある質問faq)

---

## 1. まずは1ページ作る（クイックスタート）

1. アプリを起動し、本文モードで編集を開始します。
2. 役名セルに登場人物名を入力します。
3. `Enter` または `Tab` で本文セルへ移動し、セリフ／ト書きを入力します。
4. 次の発話（次レコード）を追加したい場合は `Ctrl+Enter` を押します。
5. しばらく入力したら `Ctrl+S` で保存します（`.vse`）。
6. PDFとして出力します（詳しくは [5章](#5-pdf出力の手順と注意)）。

> コツ：最初は「役名→本文→Ctrl+Enter」のリズムで進めると迷いません。

---

## 2. 用語と基本概念

- **役名セル**：登場人物名が入る領域（1段目）
- **本文セル**：セリフ・ト書きが入る領域（2段目）
- **レコード**：役名セル＋本文セルの1セット
- **役名辞書**：ドキュメント内の役名一覧と背景色を管理する辞書

VSE は Word のように空白で揃えるのではなく、レコード構造を前提に表示・PDF出力で整列します。

---

## 3. 編集の基本（入力・改行・レコード追加）

### 3.1 レコード追加

- `Ctrl+Enter`：次のレコードを追加して移動します。

### 3.2 役名セル→本文セル

- 役名セルで `Enter` / `Tab`：本文セルへ移動します。

### 3.3 本文セルの Enter 挙動（重要）

本文セルでは、次のルールで `Enter` が動作します。

- **行に文字がある場合**：本文セル内で改行します。
- **行が空の場合**：次のレコードへ移動します（存在しなければ新規作成します）。
- **空行を本文内に残したい場合**：`Shift+Enter` を使います（空行でも次レコードに移動しません）。

> よくある誤解：空行で `Enter` を押すと「改行」ではなく「次レコードへ移動」になります。空行を残したい場面では `Shift+Enter` を使ってください。

---

## 4. モードの使い分け

### 4.1 本文モード（デフォルト）
縦書き2段組で編集する基本モードです。PDF出力時の見た目は基本的に本文モードに準拠します。ページ端に到達すると自動で改ページされます。

### 4.2 概要モード
タイトル／あらすじ／登場人物紹介を編集するモードです。PDF出力では本文の前に差し込まれます。  
概要モードは **自動改ページしない**ため、改ページしたい場合は `Ctrl+Enter` を使います。

### 4.3 簡易モード
横書きで編集するモードです。操作体系や編集対象は本文モードと同一で、内容は同期します。  
縦書き表示が不要な場面（下書き、テンポ良く入力したい時など）で有効です。

### 4.4 選択モード
テキスト出力の範囲（レコード）を選択するためのモードです。選択した範囲のみが出力されます。  
選択モード中は編集できません。

---

## 5. PDF出力の手順と注意

### 5.1 出力手順（概略）
1. 必要なら概要モードで前付け（あらすじ等）を編集します。
2. 本文モードに戻り、警告が残っていないことを確認します。
3. PDF出力を実行します。

### 5.2 PDF出力できない（ブロックされる）代表例
- **1レコードが1ページに収まらない状態**がある場合、PDF出力は停止（ブロック）されます。

対処の考え方：
- そのレコードを分割する（文章の区切りで次レコードへ）
- ト書き・説明文を別レコードに分ける
- 役名なしレコード（役名空）を活用して状況説明を分離する

> この挙動は仕様であり、ソフト側で自動分割は行いません。詳細は Document.md の「改ページ・ページング仕様」を参照してください。

---

## 6. テキスト出力（整形出力／範囲出力）

### 6.1 整形出力（`役名「本文」` など）
VSE はレコードを、整形した1行テキストとして出力できます。  
出力形式の詳細（シーン判定、括弧判定、役名なし時の Tab など）は [Document.md](./Document.md) を参照してください。

### 6.2 範囲指定して出力（選択モード）
1. 選択モードへ切り替えます。
2. クリック/Shift+クリックでレコード範囲を選択します。
3. テキスト出力を実行すると、選択範囲のみが出力されます。

### 6.3 注意（本文内改行）
本文セル内の改行は、テキスト出力時に畳まれます（無区切りで連結されます）。  
「台詞を1行として扱いたい」用途に合わせた仕様です。

---

## 7. テキスト読み込み（UTF-8）

- 読み込みは `UTF-8` を想定しています。
- 整形済みテキスト（`役名「本文」` / `役名（本文）` / `【シーン数：シーン説明】` 等）を1行1レコードとして読み込めます。

混在形式などの取り扱いは複雑になりがちなため、詳細ルールは Document.md の「整形済みテキストの読み込みルール」を参照してください。

---

## 8. 見た目・表示の調整（倍率・罫線・記号など）

- 表示倍率：`Ctrl++` / `Ctrl+-`（マウスホイールでも変更可能）
- 罫線、改行・改ページ記号、ページ番号などは表示ON/OFF切り替えが可能です。
- 表示倍率や記号表示など、一部はアプリ設定として保持されます（ドキュメント保存対象外の項目があります）。

### 8.1 役名辞書（色設定）

- 役名辞書は、役名ごとの背景色を管理します。
- 役名は前後空白を除去した文字列で扱われ、同名の役は一括で反映されます。
- 役名に `／` が含まれる場合は、分割した各役名ごとに色が適用されます。
- 役名が空、または `シーン` で始まるレコードは、役名辞書の対象外です。

---

## 9. よくある質問（FAQ）

### Q. 「空行で Enter」を押すと次のレコードへ移動してしまう
A. 仕様です。空行を本文内に残したい場合は `Shift+Enter` を使ってください。

### Q. PDF出力ができない（止められる）
A. 1レコードが1ページに収まらない警告が残っている可能性があります。レコードを分割してください（[5.2](#52-pdf出力できないブロックされる代表例)）。

### Q. 役名がない説明文（音照指示や場面説明など）はどう書く？
A. 役名セルを空にしたレコードとして入力します（仕様上、役名領域は確保されたまま表示されます）。
