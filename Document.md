# 脚本制作専用 Windowsソフト 仕様ドキュメント（確定版）

更新: 2026-01-24  
対象: 日本語縦書き脚本（台本）制作、A4横向き PDF出力

---

## 1. 目的・背景

- Wordで縦書き台本を作る際、段区切り・改ページ・手作業での揃えが発生し、制作負荷が高い。
- 台本の「役名（登場人物名）＋本文（セリフ／括弧付きト書き含む）」という構造を前提とした専用エディタを開発し、見た目の崩れや手作業調整を排除する。

---

## 2. 必須機能（要件一覧）

1. 日本語入力（IME対応）
2. 独自ファイル形式で保存・読込
3. A4横向きでの印刷・PDF出力
4. 縦書き対応
5. 「役名（1段目）」「本文（2段目）」をレコード単位で紐付けて編集
6. 指定範囲を `役名「本文」` 形式へ整形してテキスト出力（コピー/書き出し）
7. 役名に応じた背景色（簡易色数）を役名ラベルへ付与

---

## 3. 編集モデル（内部データ）

### 3.1 レコード（最重要概念）

文書は「レコード」の配列として管理する。

- レコード:
  - 役名（1段目）: `string`（空文字可）
  - 本文（2段目）: `string`（改行を含む）
  - （将来拡張: 装飾/メタデータ等）
- 概要モード本文:
  - 概要ページ用の自由テキストを別フィールドで保持する。

> Wordのように見た目を空白で揃えるのではなく、レコード構造として保持し、表示・PDF出力で自動整列する。

### 3.2 セリフ／ト書きの扱い

- ト書きは「括弧付きの本文」として扱い、内部データ上はセリフと同一（本文文字列）とする。
- 役名なしの行（シーン見出し、状況説明等）は「役名が空のレコード」として表現する。

---

## 4. 表示仕様（WYSIWYG編集）

### 4.1 ページ構造

- A4横向き単一領域（用紙全体を左右・上下で分割しない）。
- 縦書き（右から左へ列が進む）。
- 編集中の表示は、最終PDF出力の見た目に可能な限り一致させる（WYSIWYG）。

### 4.2 役名ラベル表示

- 各レコードの先頭列の上部に役名ラベルを表示する。
- レコード本文が改行等で複数列にわたっても、役名は先頭列にのみ表示し、続きの列では役名側は空欄扱いとする。

### 4.3 役名なしレコード

- 役名領域（1段目）は確保したまま、役名は空で表示する（=役名段を潰さない）。
- 本文は通常通り本文領域から開始する。

### 4.4 レコード間余白（確定）

- レコード間の余白は **1.0字分** とする。

### 4.5 罫線表示

- 画面上で縦方向の罫線を表示する（表示ON/OFF切替）。
- PDF出力には含めない。

### 4.6 表示モード

- 本文モード:
  - 役名セル＋本文セルの2段構成。
  - 縦書きページング表示。
- 概要モード:
  - 自由入力（段組みなし・縦書き）。
  - `Ctrl+Enter` で手動改ページ（ページ区切り）を挿入する。
  - 溢れ警告はページ単位で表示。
  - 選択モードは利用不可。
- 簡易モード:
  - 横書き2列（役名セル＋本文セル）表示。
  - ページ概念なし（スクロール表示）。
  - 役名セル幅は「役名セル上限文字数 × フォントサイズ」の幅とする。
  - 編集内容は本文モードと同期する。
- 選択モード:
  - 編集不可（カーソル非表示）。
  - クリック/Shift+クリックでレコード範囲を選択する。
  - 選択ハイライトは薄い緑。

### 4.7 ステータスバーと倍率

- ステータスバーに文字数、ページ情報、現在モード、表示倍率を表示する。
- ズームはスライダーと `Ctrl+スクロール` で変更でき、アプリ設定として保持する。


### 4.8 改行・改ページ記号表示

- 改行と改ページがわかりやすいよう記号を表示する。
- 「表示」からON/OFF切替可能。
- 記号は表示専用で、カーソル移動・編集・コピーの対象にはしない。
- 改行記号は行末表示とする。
- 表示ON/OFFはアプリ設定として保持する（ドキュメント保存対象外）。

---

## 5. キー操作仕様（確定）

### 5.1 カーソル移動（セル間）

- `Tab`：役名セル → 本文セル
- `Tab`：本文セル内ではタブ文字を挿入
- `Shift+Tab`：本文セル → 役名セル（役名セルでも本文セルへ移動）
- 役名セルで `Enter`：本文セルへ移動

### 5.2 レコード遷移

- `Ctrl+Enter` ：常に「次レコードを新規追加して移動」する。
- `Ctrl+Shift+Enter`：常に「前レコードを新規追加して移動」する。

### 5.3 編集履歴（Undo/Redo）

- `Ctrl+Z`：もとに戻す（Undo）
- `Ctrl+Y`：やり直し（Redo）

### 5.4 本文セル内の改行・Enter挙動（確定）

本文セルでは、以下のルールで `Enter` を解釈する。

- `Enter`（通常）：基本は本文内改行
  - ただし、カーソル位置の「現在行」が空行の場合は、次レコードへ移動する  
    （結果として「Enter 2回で次レコード」が成立）
    （空行の削除は「レコード移動時」に行い、本文末尾に空行が残っていれば削除する）
- `Shift+Enter`：空行であっても強制的に改行として挿入（空行を許容）

### 5.5 Ctrl+矢印キーのセル間移動

- `Ctrl+→`：前のセルへ移動
- `Ctrl+←`：次のセルへ移動
- `Ctrl+↑`/`Ctrl+↓`：レコード間のセル移動を行う  
  - 本文セルで `Ctrl+↓`：次レコードの役名セル  
  - 役名セルで `Ctrl+↑`：前レコードの本文セル  
  - 上記以外はレコード内の役名/本文セルを切り替える

---

## 6. レコード削除（確定）

- 該当レコードが空（役名が空、かつ本文が空）の場合、そのレコードで `Backspace` を押すことでレコード削除を行う。

---

## 7. 改ページ・ページング仕様（確定）

### 7.1 レコード分割禁止（Keep-together）

- 同一レコード内に改ページを入れない。
- ページ末尾に入り切らない場合、レコード全体を次ページ先頭へ送る。

### 7.2 1レコードが1ページに収まらない場合（警告・出力ブロック）

- ソフト側で自動分割は行わない。ユーザーに区切らせる方針。

警告挙動:

1. 編集中、レコードが1ページに収まらない状態になった時点で即時に警告を一度表示
2. ユーザーが次レコードへ進んだ時点でも未解決なら、再警告 + 該当レコードの強調表示
3. 未解決のままPDF出力を実行しようとした場合、PDF出力を停止（ブロック）

---

## 8. PDF出力・印刷仕様（確定）

- 目標は「編集画面の見た目のまま」A4横向きでPDF出力できること。
- 1レコードでも「1ページに収まらない」警告が残っている場合はPDF出力不可。
- 罫線はPDFに含めない。

### 8.1 組版パラメータ（固定値）

- フォント：游明朝 **11.18pt 固定**
- 行間：**1.7**
- 余白：左右 **21.1mm**、上下 **25.4mm**
- 役名セル上限文字数：**4.0**
  - 役名セル表示枠の高さは「上限文字数 - 1」を基準にする

### 8.2 ページ番号

- 位置：下中央固定
- 設定：ON/OFF切替可能
- フォント：游ゴシック太字

---

## 9. テキスト出力仕様（確定）

### 9.1 選択範囲の指定（確定）

- 選択範囲は「本文レコードのみ」を連続して選択していく方式とする。
  - 役名列単独の選択や、非連続選択は前提としない。

### 9.2 出力形式

- 役名ありレコード：
  - 役名が `シーン` で始まる場合：`【役名：本文】`
  - 本文が `（...）` で囲まれている場合：`役名（本文）`
  - それ以外：`役名「本文」`
- 役名なしレコード：行頭に `Tab` を付けて本文のみ

### 9.3 本文内改行の扱い（確定）

- 本文内改行は無視し、無区切りで連結して1行に畳む。

### 9.4 セリフのみコピー

- 本文のみを出力する（役名は出力しない）。
- レコード間に空行を挿入する。
  - 例：`本文行1\n本文行2` → `本文行1本文行2`

---

## 10. 色仕様（役名ラベル背景）

- 色は「簡易的」= 色数が豊富である必要はない。
- 表示対象：役名ラベルの背景色のみ。
- 付与方式：
  - 自動割当は行わない。
  - 役名辞書から一括で付与・変更できる。
  - 手動で変更も可能（UIを用意）。

### 10.1 同名役の統合（確定）

- 同一の役名文字列は、自動で同一人物として統合する。
  - 役名辞書上の定義・色割当・設定変更は、同名役に一括で反映される想定。

### 10.2 役名辞書（仕様）

- 役名辞書は、ドキュメント内の「役名一覧」と「表示設定（色）」を保持する。
- 役名は前後空白を除去した文字列をキーとして扱う。
- 役名に `／` が含まれる場合は、分割した各役名を辞書対象とする。
- 役名が空、または `シーン` で始まるレコードは辞書対象外とする。
- レコードの追加/変更/削除に応じて辞書を更新する（存在しない役名は辞書から除外される）。
- 辞書で設定した色は、該当する全レコードの役名ラベルに反映される。

---

## 11. 保存・読込仕様（概要）

- Wordではなく独自ファイル形式で保存/読込する。
- 保存対象（最低限）:
  - レコード配列（役名/本文）
  - ページ番号ON/OFF
  - 罫線表示ON/OFF
  - 概要モード本文
  - 役名辞書（同名統合、色設定 等）

（具体的なファイル形式、バージョニング、互換性方針は別途設計）

---


### 11.1 保存・クローズ時の警告

- 未保存の変更がある場合、以下の操作で警告を表示する。
  - 新規作成
  - 開く
  - 閉じる
  - ウィンドウ終了（×）

### 11.2 整形済みテキストの読み込みルール

- 1行1レコードとして解釈する。
- 行頭が `Tab` の場合は役名なしレコードとして扱う。
- 行頭が `「` または `（` の場合は役名なしレコードとして扱う。
- 役名が `シーン` で始まる場合は `【役名：本文】` 形式を優先する。
- `役名「本文」` / `役名（本文）` 形式を読み込む。
- `役名「本文1」（本文2）「本文3」` のような混在形式は、本文側から `「」` を除去して取り込む。
- 全角の `「」` / `（）` のみを対象とする。

### 11.3 環境設定

- 役名セル上限文字数を変更できる。
- 表示倍率はアプリ設定として保持する。
- 改行・改ページ記号表示ON/OFFはアプリ設定として保持する。

## 12. 将来拡張（スコープ外だが想定）

- 役名辞書の詳細実装（候補サジェスト、辞書の編集UI）
- 検索・置換（役名/本文）
- 変更履歴、差分表示等
